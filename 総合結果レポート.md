# お台場グルメ推薦システム - 3パターン比較実験 総合レポート

## 📋 実験概要

### 目的
ユーザーの曖昧な食のイメージ（例：あっさり、静か）と利用シーンを考慮し、最適な飲食店を推薦するシステムにおいて、**どのデータが推薦精度に最も貢献するか**を検証する。

### 比較対象の3パターン

| パターン | 特徴量 | 目的 |
|---------|--------|------|
| **P1** | カテゴリ + 星の数 | ベースライン（基準）性能測定 |
| **P2** | カテゴリ + レビュー | レビュー（イメージ）の貢献度を検証 |
| **P3** | カテゴリ + レビュー + 星の数 | 全情報統合モデルの性能測定 |

## 📊 データ概要

- **レビュー総数**: 29,385件
- **店舗数**: 404店舗（お台場エリア）
- **カテゴリ数**: 139種類
- **エリア**: お台場、有明、東京ビッグサイト周辺

## 🔧 実装技術

### 基本手法
- **カテゴリエンコーディング**: MultiLabelBinarizer（複数カテゴリ対応）
- **星評価の正規化**: MinMaxScaler
- **レビューベクトル化**: TF-IDF
- **推薦アルゴリズム**: コサイン類似度
- **形態素解析**: Janome

### 改善版v2の追加施策
1. **L2正規化**: 各特徴量グループを独立に正規化
2. **TF-IDF次元削減**: 3000次元 → 500次元
3. **カテゴリ重み付け**: ×2.0（カテゴリの重要性を強化）
4. **ストップワード除去**: 意味の薄い単語を削除

## 📈 実験結果

### 改善版v2の結果（最終版）

#### 各パターンの平均類似度

```
P1（カテゴリ+星）:        0.5968 🏆
P2（カテゴリ+レビュー）:  0.4322
P3（全情報統合）:        0.5268
```

#### シナリオ別詳細結果

| シナリオ | P1 | P2 | P3 |
|---------|-----|-----|-----|
| イタリアン（クリーミーなパスタ） | **0.608** | 0.458 | 0.549 |
| 和食（静かで落ち着いた雰囲気） | **0.608** | 0.424 | 0.520 |
| 海鮮（新鮮な刺身） | **0.575** | 0.415 | 0.512 |

### 特徴量貢献度分析

```
レビュー情報の平均貢献度:  -0.1646  ⬇️
星評価の平均貢献度:        +0.0946  ⬆️
```

## 🔍 主要な発見

### 1. **カテゴリ+星評価（P1）が最高性能**

予想に反して、**P1が最も高い推薦精度**を示しました。
- 平均類似度: 0.597
- 全3シナリオで最高スコアを記録

### 2. **レビュー情報の貢献度がマイナス**

レビューテキストを追加することで、推薦精度が**約16%低下**しました。

**考えられる原因:**
- **次元の不均衡**: レビュー特徴量（500次元）がカテゴリ（139次元）を圧倒
- **ノイズの混入**: レビューテキストに含まれる無関係な情報
- **データ量の不足**: お台場のみ404店舗は小規模
- **レビュー処理の限界**: TF-IDFだけでは意味的な類似度を捉えきれない

### 3. **星評価の追加は効果的**

P2からP3への改善（+0.095）により、星評価情報には一定の価値があることを確認。

### 4. **カテゴリフィルタリングの重要性**

改善版では、ユーザー指定カテゴリに該当する店舗のみを推薦対象とすることで、適切な推薦を実現。
- 以前: 「イタリアン」指定で日本料理店が推薦される問題
- 改善後: イタリアンを含む店舗のみが推薦対象に

## 💡 実用的な推奨事項

### 現段階での最適なアプローチ

**P1（カテゴリ + 星評価）を基本モデルとして採用**

理由:
- 最も高い推薦精度
- 計算コストが低い（特徴量次元: 140）
- 解釈性が高い（カテゴリと評価のみ）

### レビュー情報の活用方法

レビューを直接特徴量に含めるのではなく、以下の用途で活用:

1. **補助的な情報表示**: 推薦結果にレビュー抜粋を表示
2. **事前フィルタリング**: 特定キーワード（「個室」「禁煙」など）での絞り込み
3. **後処理ランキング**: P1で候補を選定後、レビュー類似度で再ランキング

## 🚀 今後の改善方向

### 1. 全国データへの拡張

現在の404店舗から**数千〜数万店舗規模**にスケールアップ
- より多様なカテゴリ
- レビュー数の増加によるTF-IDF精度向上
- 地域性を考慮した推薦

### 2. レビュー処理の高度化

**TF-IDFの限界を超える手法:**
- **BERT/Sentence-BERT**: 文の意味的類似度を捉える
- **Doc2Vec**: レビュー全体の埋め込み表現
- **トピックモデリング**: LDAによるレビューの潜在トピック抽出
- **感情分析**: ポジティブ/ネガティブの度合いを数値化

### 3. ハイブリッドアプローチ

```
ステップ1: カテゴリフィルタリング（該当する店舗を絞り込み）
    ↓
ステップ2: P1で候補をランキング（カテゴリ+星評価）
    ↓
ステップ3: レビュー類似度で再ランキング（上位N件のみ）
```

### 4. ユーザーフィードバックの活用

- クリック率、滞在時間などの暗黙的フィードバック
- 「いいね」「保存」などの明示的フィードバック
- 協調フィルタリングとの組み合わせ

### 5. 追加特徴量の検討

- **価格帯**: 予算に応じた推薦
- **営業時間**: 利用時間帯による絞り込み
- **立地情報**: 駅からの距離、エリア特性
- **雰囲気スコア**: 既存の`shop_atmosphere_scores.csv`を活用

## 📦 成果物

### 生成ファイル一覧

```
B2-store-recommend/
├── main_improved.ipynb              # 改善版ノートブック
├── run_experiment.py                # 基本版実行スクリプト
├── run_experiment_improved_v2.py    # 改善版v2実行スクリプト
├── experiment_summary.txt           # 基本版結果サマリー
├── experiment_summary_v2.txt        # 改善版v2結果サマリー
├── pattern_comparison.png           # パターン別比較グラフ（基本版）
├── pattern_comparison_v2.png        # パターン別比較グラフ（v2）
├── scenario_comparison.png          # シナリオ別比較グラフ（基本版）
├── scenario_comparison_v2.png       # シナリオ別比較グラフ（v2）
└── 総合結果レポート.md              # 本レポート
```

### グラフの見方

#### pattern_comparison_v2.png
- 3つのシナリオそれぞれで、P1/P2/P3の平均類似度を比較
- 全シナリオでP1が最高スコアを示していることが視覚的に確認可能

#### scenario_comparison_v2.png
- 横軸: 3つのテストシナリオ
- 縦軸: 平均類似度
- パターン別（P1/P2/P3）に色分けしてプロット

## 🎓 研究上の意義

### 本研究の貢献

1. **実証的な比較**: 3パターンの定量的比較により、各特徴量の貢献度を明確化
2. **実装可能性**: 実用的な推薦システムとして動作するプロトタイプを実装
3. **スケーラビリティ**: 全国データへの拡張を見据えた設計

### 論文・レポートでの活用

**主張できる内容:**
- カテゴリと星評価の組み合わせが、小規模データセットでは最も効果的
- レビューテキストの直接利用には課題があり、より高度な自然言語処理が必要
- 段階的フィルタリング（カテゴリ→評価→レビュー）が有望

**考察の方向性:**
- データセット規模の影響（404店舗 vs 全国データ）
- ドメイン依存性（グルメ推薦 vs 他の推薦タスク）
- ユーザー行動との相関分析

## 📝 まとめ

### 現時点での結論

✅ **お台場データセットにおいては、P1（カテゴリ+星評価）が最適**
- 平均類似度: 0.597
- 計算効率: 高
- 解釈性: 高

⚠️ **レビュー情報の活用には課題あり**
- 現状のTF-IDFベースでは精度向上に寄与せず（-0.165）
- より高度な自然言語処理手法の導入が必要

🚀 **全国データへの拡張で状況が変わる可能性**
- データ量増加によるレビュー特徴量の質的向上
- より多様なカテゴリ・シナリオでの検証

### 次のステップ

1. **全国データでの再実験** ← 最優先
2. **レビュー処理の高度化**（BERT等）
3. **ハイブリッド推薦モデルの実装**
4. **ユーザー評価実験の実施**

---

**実験実施日**: 2025年11月7日
**データセット**: お台場エリア（404店舗、29,385レビュー）
**使用技術**: Python, scikit-learn, Janome, Matplotlib
